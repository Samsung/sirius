<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><h1 id="SiriusEvolutionSpecificationSnaptoallshapes">Sirius Evolution Specification: Snap to all shapes</h1><h2 id="Preamble">Preamble</h2><p><em>Summary</em>: Add capability to snap to all shapes when moving or resizing a node or a container.</p><table><tr><th>Version </th><th>Status </th><th>Date        </th><th>Authors </th><th>Changes </th></tr><tr><td>v0.1        </td><td>DRAFT    </td><td>2015-04-08 </td><td>lredor    </td><td>Initial version. </td></tr><tr><td>v0.2        </td><td>PROPOSAL    </td><td>2015-04-08 </td><td>lredor    </td><td>Reviewed version. </td></tr></table><p><em>Relevant tickets</em>:</p><ul><li><a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=463485">Bug 463485 &#8211; Snap to all shapes</a></li></ul><h2 id="Introduction">Introduction</h2><p>There is currently the capability to snap to shape during moving or resizing a node. This capability is inherited from GMF framework. To enable it, select the diagram and in the <em>Properties</em> view, in <em>Rulers &amp; Grid</em> tab, check the checkbox <em>Snap To Shapes</em>. As explained in <a href="https://wiki.eclipse.org/Graphical_Modeling_Framework/Versions/GMF_2.1#GEF_Alignment_Feature:_Snap_To_Geometry_added_in_the_GMF_Runtime">GMF doc</a>, <cite>However, edit parts can only snap to other edit parts that share the same parent.</cite>   <br/>The goal of this feature is to enable on demand the snap to all shapes and not only with the same container. </p><h2 id="DetailedSpecification">Detailed Specification</h2><p>This new behavior will be available only if <em>Snap To Shapes</em> is already enabled. To add this new behavior, the user should press a specific shortcut.<br/>Shift, Ctrl and Alt is already used by other GMF behaviors during resize/move. So we must use function key as shortcut. The chosen function key is <strong>F4</strong> (not used by other functions on diagram as F5 for refresh for example).</p><p>For information the other shortcuts used during resize by GMF or other Sirius features are:</p><ul><li>Control key: Centered resize</li><li>Shift key: Resize that keeps ratio</li><li>Alt key: Resize that disables the snap</li><li>F3: Resize container and keep children relative</li></ul><p>For information the other shortcuts used during move by GMF are:</p><ul><li>Shift key: Constrained move</li><li>Alt key (Control key on Mac): Ignore snap while dragging</li></ul><p>The <em>Snap To Shapes</em>, uses all the shapes that share the same parent, even if they are not visible.<br/>In contrast, when the user press <strong>F4</strong> function key, all <strong>visible</strong> shapes are used.</p><p>As for <em>Snap To Shapes</em>, this feature is available on:</p><ul><li>Node,</li><li>Container,</li><li>List,</li><li>Note,</li><li>Text,</li><li>Bendpoints of edges (but without feedback)</li></ul><p>If a container is resized, or moved, it will not be snapped to their children. </p><p>Some screenshots of this new feature are shown below.<br/><img border="0" src="images/snapToAllShapes.png"/><br/><img border="0" src="images/snapToAllShapes_2.png"/></p><h3 id="Knownlimitations">Known limitations</h3><p>The <em>Snap To Shapes</em> feature is not operational when moving or resizing a border node. It will be the same for this new feature. However, all nodes can be snapped to existing border nodes.</p><h2 id="BackwardCompatibilityandMigrationPaths">Backward Compatibility and Migration Paths</h2><p>This evolution does not change any API.</p><h3 id="UserInterfaceChanges">User Interface Changes</h3><p>No user interface change.</p><h3 id="DocumentationChanges">Documentation Changes</h3><p>This new behavior should be added in the New and Noteworthy documentation. <br/>A note should also be added in the user doc to explain this new feature (and possibly for the existing move shortcuts):</p><ul><li>Complete chapter Diagram Editors/Features Overview/Resizing elements</li><li>Add new chapter Diagram Editors/Features Overview/Moving elements</li></ul><h2 id="TestsandNonregressionstrategy">Tests and Non-regression strategy</h2><p>Add new tests that resize elements and move elements. The data from test <code>org.eclipse.sirius.tests.swtbot.PortsOnNodePositionStabilityTest</code> can be used as it uses both nodes, border nodes and container nodes.<br/>Points to consider during tests:</p><ul><li>Shapes not visible in the diagram (they should be ignored by the snap)</li><li>Shapes not visible in a container (they should be ignored by the snap)</li><li>Different zoom levels</li><li>With or without scroll in diagram/in container</li><li>With Control and F4 keys pressed (Control key should disable the snap)</li></ul><p>Warning: These tests need to update the SWTBot framework or at least add new methods in our part to drag a node with a shortcut key pressed.  </p><h2 id="Implementationchoicesandtradeoffs">Implementation choices and tradeoffs</h2><p>Excluded shortcuts:</p><ul><li>The shortcut is not only a character key because this can be in conflict with the direct edit mode (if enabled).</li><li>The combination with ALT key is already used to activate menu.</li><li>The combination with SHIFT key is already used for uppercase key of direct edit mode.</li><li>The combination with CTRL key can conflict with action shortcuts. For example, &#171;CTRL+r&#187; conflicts with the reveal all action.</li></ul><p>Excluded behaviors:</p><ul><li>Change the behavior of the <em>Snap To Shapes</em> (instead of add a shortcut)</li><li>Change the UI of <em>Rulers &amp; Grid</em> to show a new <em>Snap To All Shapes</em> checkbox<ul><li>It will not really a checkbox, because it must be exclusive with existing <em>Snap To Shapes</em> checkbox.</li><li>This also needs to modify global Sirius diagram preferences.</li></ul></li></ul></body></html>